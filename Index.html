<!DOCTYPE html>
<html lang="en">
        <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <link rel="icon" type="image/png" href="PlasmaPuffs.png">
                <title>PlasmaPuffs</title>
                <style>
                        @import url("https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap");

                        :root {
                                --background-color-1: rgba( 25,  25,  25, 1.0);
                                --background-color-2: rgba( 10,  10,  10, 1.0);
                                --foreground-color-1: rgba(255, 255, 255, 0.87);
                                --foreground-color-2: rgba(255, 255, 255, 0.60);
                                --foreground-color-3: rgba(255, 255, 255, 0.38);
                        }

                        * {
                                color: var(--foreground-color-1);
                                font-family: "Inter", sans-serif;
                                box-sizing: border-box;
                        }

                        html, body {
                                margin: 0;
                                padding: 0;
                                width: 100%;
                                height: 100%;
                                overflow: hidden;
                                background-color: var(--background-color-1);
                        }

                        .emoji {
                                width: 1em;
                                height: 1em;
                                vertical-align: -0.2em;
                        }

                        .header {
                                position: sticky;
                                top: 0;
                                width: 100%;
                                height: 5rem;
                                background-color: var(--background-color-2);
                                display: flex;
                                align-items: center;
                                padding: 0 1rem;
                                z-index: 10;
                        }

                        .header > nav {
                                display: flex;
                                width: 100%;
                                align-items: center;
                        }

                        .header > nav > .logo {
                                flex: 0 0 auto;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                padding: 1rem;
                                max-height: 100%;
                                user-select: none;
                        }

                        .header > nav > .logo > img {
                                height: 100%;
                                width: auto;
                                max-width: 3rem;
                                object-fit: contain;
                        }

                        .header > nav > a:not(.logo) {
                                margin-left: 2rem;
                                user-select: none;
                                text-decoration: none;
                                border-bottom: 2px solid transparent;
                                display: flex;
                                align-items: center;
                                height: 100%;
                                gap: 0.5rem;
                        }

                        .header > nav > a:not(.logo):hover {
                                border-bottom: 2px solid var(--foreground-color-1);
                        }

                        main {
                                width: 100%;
                                height: calc(100% - 4rem);
                                overflow-y: auto;
                        }

                        main > section {
                                padding-top: 2rem;
                                padding-left: 4rem;
                                padding-right: 4rem;
                        }
                </style>
        </head>
        <body>
                <header class="header">
                        <nav>
                                <a href="/" class="logo" data-navigation-link>
                                        <img src="PlasmaPuffs.png" alt="PlasmaPuffs Icon"></img>
                                </a>
                                <a href="/sokobee" data-navigation-link>Sokobee</a>
                                <a href="/nothing" data-navigation-link>Testing</a>
                        </nav>
                </header>
                <main id="content">
                        <section id="home-section" hidden>
                                <h1>Welcome</h1>
                                <p>This is the home page!</p>
                        </section>
                        <section id="page-section" hidden>
                        </section>
                        <section id="void-section" hidden>
                                <!-- TODO: Display more information about the error -->
                                <h2>Page not found</h2>
                                <p>The page couldn't be loaded.</p>
                        </section>
                </main>
        </body>
        <script>
                const homeSection = document.getElementById("home-section");
                const pageSection = document.getElementById("page-section");
                const voidSection = document.getElementById("void-section");

                function displaySection(section) {
                        console.info(`Displaying section: ${section}...`);
                        homeSection.hidden = true;
                        pageSection.hidden = true;
                        voidSection.hidden = true;
                        section.hidden = false;
                }

                async function loadPage(path = window.location.pathname) {
                        console.info(`Loading page from path: "${path}"...`);

                        // The path is "/Index.html" when running locally (during development) but
                        // I also need to include "/" since static servers treat "/Index.html" as
                        // the default page (or "/") in a directory.
                        if (path === "/" || path.endsWith("/Index.html")) {
                                displaySection(homeSection);
                                return;
                        }

                        let pageFile;
                        switch (path) {
                                case "/sokobee": {
                                        pageFile = "Sokobee.html";
                                        break
                                }

                                default: {
                                        displaySection(voidSection);
                                        return;
                                }
                        }

                        try {
                                const response = await fetch(pageFile);
                                if (response.ok === false) {
                                        console.error(`Failed to load page ${pageFile}: ${response.status} ${response.statusText}`);
                                        displaySection(voidSection);
                                        return;
                                }

                                displaySection(pageSection);
                                pageSection.innerHTML = await response.text();

                                // Scripts added directly to the HTML as strings don't get executed so I
                                // need to replace them my themselves manually to execute each script.
                                const scripts = pageSection.querySelectorAll("script");
                                for (const script of scripts) {
                                        const newScript = document.createElement("script");

                                        if (script.textContent) {
                                                newScript.textContent = script.textContent;
                                        }

                                        for (const attribute of script.attributes) {
                                                newScript.setAttribute(attribute.name, attribute.value);
                                        }

                                        script.parentNode.replaceChild(newScript, script);
                                }
                        } catch (error) {
                                console.error(`Navigation error: ${error}`);
                                displaySection(voidSection);
                                return;
                        }
                };

                // When a navigation link is clicked, the behavior is overriden to correctly use
                // the browser's history API to change the page.
                document.addEventListener("click", event => {
                        const link = event.target.closest("[data-navigation-link]");
                        if (!link) {
                                return;
                        }

                        event.preventDefault();

                        const path = link.getAttribute("href");
                        history.pushState({}, "", path);
                        loadPage(path);
                });

                window.addEventListener("popstate", () => {
                        loadPage(window.location.pathname);
                });

                // The 404 fallback script adds a query parameter before redirecting to this page
                // to keep track of the current page (when reloading on github pages). If the
                // paramter contains a value, this will set the state correctly with the history
                // API.
                const searchParameters = new URLSearchParams(window.location.search);
                if (searchParameters.has("redirect")) {
                        const redirectPath = searchParameters.get("redirect");
                        history.replaceState({}, "", redirectPath);
                }

                loadPage();
        </script>
</html>