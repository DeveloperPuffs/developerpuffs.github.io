<!DOCTYPE html>
<html lang="en">
        <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <link rel="icon" type="image/png" href="PlasmaPuffs.png">
                <title>PlasmaPuffs</title>
                <style>
                        @import url("https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap");

                        html, body {
                                margin: 0;
                                padding: 0;
                                width: 100%;
                                height: 100%;
                                overflow: hidden;
                                background-color: #222222;
                        }

                        :root {
                                --foreground-color: rgba(255, 255, 255, 0.87);
                        }

                        * {
                                color: var(--foreground-color);
                                font-family: "Inter", sans-serif;
                                box-sizing: border-box;
                        }

                        .emoji {
                                width: 1em;
                                height: 1em;
                                vertical-align: -0.2em;
                        }

                        .wrapper {
                                width: 100%;
                                height: 100%;
                                overflow-y: auto;
                                background-color: #222222;
                                padding: 2rem;
                        }

                        .header {
                                top: 0;
                                left: 0;
                                width: 100%;
                                height: 4rem;
                                position: sticky;
                                border-radius: 0.5rem;
                                background-color: #333333;
                                border-bottom: 0.25rem solid #555555;
                                list-style: none;
                                align-items: center;
                                display: flex;
                                padding-left: 2rem;
                                padding-right: 2rem;
                                padding-top: 1rem;
                                padding-bottom: 1rem;
                                gap: 2rem;
                        }

                        .header li {
                                display: flex;
                                align-items: center;
                                min-width: 2rem;
                                max-width: 10rem;
                                height: 100%;
                        }

                        .header li a {
                                width: 100%;
                                display: flex;
                                align-items: center;
                                text-decoration: none;
                                transition: border-bottom 100ms ease-out;
                                border-bottom: 0.15rem solid transparent;
                                font-size: larger;
                                padding: 0.25rem;
                                gap: 0.5rem;
                        }

                        .header li:hover a {
                                border-bottom: 0.15rem solid var(--foreground-color);
                        }

                        .header li a span {
                                width: calc(100%);
                                white-space: nowrap;
                                display: inline-block;
                                text-overflow: ellipsis;
                                overflow: hidden;
                        }

                        main {
                                width: 100%;
                                padding-left: 2rem;
                                padding-right: 2rem;
                                padding-bottom: 2rem;
                                padding-top: 1rem;
                        }
                </style>
        </head>
        <body>
                <div class="wrapper">
                        <header>
                                <nav>
                                        <a href="/sokobee" class="navigation-link">
                                                <img src="Hexagon.png" alt="Hexagon Tile" class="emoji"></img>
                                                <span>Sokobee</span>
                                        </a>
                                </nav>
                        </header>
                        <main id="content">
                                <section id="home-section" hidden>
                                        <h1>Welcome!</h1>
                                        <p>This is the home page directly in index.html.</p>
                                </section>
                                <section id="page-section" hidden>
                                </section>
                                <section id="void-section" hidden>
                                        <!-- TODO: Display more information about the error -->
                                        <h2>Page not found</h2>
                                        <p>The page couldn't be loaded.</p>
                                </section>
                        </main>
                </div>
        </body>
        <script>
                const homeSection = document.getElementById("home-section");
                const pageSection = document.getElementById("page-section");
                const voidSection = document.getElementById("void-section");

                function displaySection(section) {
                        console.info(`Displaying section: ${section}...`);
                        homeSection.hidden = true;
                        pageSection.hidden = true;
                        voidSection.hidden = true;
                        section.hidden = false;
                }

                async function loadPage(path = window.location.pathname) {
                        console.info(`Loading page from path: "${path}"...`);

                        // The path is "/Index.html" when running locally (during development) but
                        // I also need to include "/" since static servers treat "/Index.html" as
                        // the default page (or "/") in a directory.
                        if (path === "/" || path.endsWith("/Index.html")) {
                                displaySection(homeSection);
                                return;
                        }

                        let pageFile;
                        switch (path) {
                                case "/sokobee": {
                                        pageFile = "Sokobee.html";
                                        break
                                }

                                default: {
                                        displaySection(voidSection);
                                        return;
                                }
                        }

                        try {
                                const response = await fetch(pageFile);
                                if (response.ok === false) {
                                        console.error(`Failed to load page ${pageFile}: ${response.status} ${response.statusText}`);
                                        displaySection(voidSection);
                                        return;
                                }

                                displaySection(pageSection);
                                pageSection.innerHTML = await response.text();

                                // Scripts added directly to the HTML as strings don't get executed so I
                                // need to replace them my themselves manually to execute each script.
                                const scripts = pageSection.querySelectorAll("script");
                                for (const script of scripts) {
                                        const newScript = document.createElement("script");

                                        if (script.textContent) {
                                                newScript.textContent = script.textContent;
                                        }

                                        for (const attribute of script.attributes) {
                                                newScript.setAttribute(attribute.name, attribute.value);
                                        }

                                        script.parentNode.replaceChild(newScript, script);
                                }
                        } catch (error) {
                                console.error(`Navigation error: ${error}`);
                                displaySection(voidSection);
                                return;
                        }
                };

                // This overrides the behavior of the page links to correctly navigate to the
                // corresponding page using the browser's history API.
                document.querySelectorAll("a.navigation-link").forEach(link => {
                        link.addEventListener("click", event => {
                                event.preventDefault();

                                const path = link.getAttribute("href");
                                history.pushState({}, "", path);
                                loadPage(path);
                        });
                });

                window.addEventListener("popstate", () => {
                        loadPage(window.location.pathname);
                });

                const redirect = sessionStorage.getItem("redirect");
                if (redirect) {
                        sessionStorage.removeItem("redirect");
                        history.replaceState(null, "", redirect);
                }

                loadPage();
        </script>
</html>