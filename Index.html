<!DOCTYPE html>
<html lang="en">
        <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
                <link rel="icon" type="image/png" href="Assets/Icons/PlasmaPuffs.png">
                <title>PlasmaPuffs</title>
                <style>
                        @import url("https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap");

                        :root {
                                --opacity-1: 0.87;
                                --opacity-2: 0.60;
                                --opacity-3: 0.38;
                                --background-color-1: rgba(25, 25, 25, 1.0);
                                --background-color-2: rgba(10, 10, 10, 1.0);
                                --background-color-3: rgba(50, 50, 50, 1.0);
                                --foreground-color-1: rgba(255, 255, 255, var(--opacity-1));
                                --foreground-color-2: rgba(255, 255, 255, var(--opacity-2));
                                --foreground-color-3: rgba(255, 255, 255, var(--opacity-3));
                        }

                        * {
                                color: var(--foreground-color-1);
                                font-family: "Inter", sans-serif;
                                box-sizing: border-box;
                        }

                        html, body {
                                margin: 0;
                                padding: 0;
                                width: 100%;
                                height: 100%;
                                overflow: hidden;
                                background-color: var(--background-color-1);
                        }

                        code, pre {
                                background-color: var(--background-color-2);
                                padding-top: 0.25rem;
                                padding-bottom: 0.25rem;
                                padding-left: 0.5rem;
                                padding-right: 0.5rem;
                                border-radius: 2.5px;
                                font-family: Consolas, monospace;
                        }

                        button, .button {
                                background: var(--background-color-3);
                                color: var(--foreground-color-1);
                                border: none;
                                padding-top: 0.5rem;
                                padding-bottom: 0.5rem;
                                padding-left: 1.5rem;
                                padding-right: 1.5rem;
                                font-size: medium;
                                text-decoration: none;
                                border-radius: 2.5px;
                                user-select: none;
                                cursor: pointer;
                        }

                        button:hover, .button:hover {
                                opacity: var(--opacity-2);
                        }

                        details > summary {
                                user-select: none;
                                cursor: pointer;
                        }

                        details > summary:hover {
                                text-decoration: underline;
                        }

                        details > *:not(summary) {
                                margin-left: 2rem;
                        }

                        .primary-text {
                                color: var(--foreground-color-1);
                        }

                        .primary-text * {
                                color: inherit;
                        }

                        .secondary-text {
                                color: var(--foreground-color-2);
                        }

                        .secondary-text * {
                                color: inherit;
                        }

                        .disabled-text {
                                color: var(--foreground-color-3);
                        }

                        .disabled-text * {
                                color: inherit;
                        }

                        .undraggable {
                                -webkit-user-drag: none;
                                -moz-user-drag: none;
                                -ms-user-drag: none;
                        }

                        .header {
                                position: sticky;
                                top: 0;
                                width: 100%;
                                height: 5rem;
                                background-color: var(--background-color-2);
                                display: flex;
                                align-items: center;
                                padding-left: 1rem;
                                padding-right: 1rem;
                        }

                        .header > nav {
                                display: flex;
                                width: 100%;
                                align-items: center;
                        }

                        .header > nav > .logo {
                                flex: 0 0 auto;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                padding: 1rem;
                                max-height: 100%;
                                user-select: none;
                        }

                        .header > nav > .logo > img {
                                height: 100%;
                                width: auto;
                                max-width: 3rem;
                                object-fit: contain;
                        }

                        .header > nav > a:not(.logo) {
                                margin-left: 2rem;
                                user-select: none;
                                text-decoration: none;
                                font-size: large;
                                display: flex;
                                align-items: center;
                                height: 100%;
                                gap: 0.5rem;
                                position: relative;
                                border-bottom: none;
                        }

                        .header > nav > a:not(.logo)::after {
                                content: "";
                                position: absolute;
                                bottom: 0;
                                left: 50%;
                                transform: translateX(-50%) scaleX(0);
                                transform-origin: center;
                                width: 100%;
                                height: 2px;
                                background-color: var(--foreground-color-1);
                                transition: transform 100ms ease-in-out;
                        }

                        .header > nav > a:not(.logo):hover::after {
                                transform: translateX(-50%) scaleX(1);
                        }

                        main {
                                width: 100%;
                                height: calc(100% - 4rem);
                                overflow-y: auto;
                        }

                        .page-wrapper {
                                margin-left: 5rem;
                                margin-right: 5rem;
                                margin-top: 2.5rem;
                        }

                        .home-center {
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                text-align: center;
                        }

                        .home-logo {
                                width: 500px;
                                height: auto;
                                max-width: 80vw;
                                max-height: 40vh;
                                object-fit: contain;
                                user-select: none;
                                cursor: pointer;
                        }

                        .home-title {
                                margin: 0;
                                font-size: 2.5rem;
                                color: var(--foreground-color-1);
                        }

                        .socials {
                                display: flex;
                                justify-content: center;
                                width: 100%;
                                margin-top: 1rem;
                                gap: 1.5rem;
                        }

                        .socials > a {
                                width: 1.5rem;
                                height: 1.5rem;
                                user-select: none;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                opacity: var(--opacity-2);
                        }

                        .socials > a:hover {
                                opacity: var(--opacity-1);
                        }

                        .socials > a > img {
                                width: 100%;
                                height: 100%;
                                object-fit: contain;
                        }

                        .void-actions {
                                display: flex;
                                gap: 1rem;
                        }
                </style>
        </head>
        <body>
                <header class="header">
                        <nav>
                                <a href="/" class="logo" data-navigation-link>
                                        <img src="Assets/Icons/PlasmaPuffs.png" alt="PlasmaPuffs Icon" class="undraggable"></img>
                                </a>
                                <a href="/sokobee" data-navigation-link>Sokobee</a>
                                <a href="/nowhere" data-navigation-link>Nowhere</a>
                        </nav>
                </header>
                <main id="content">
                        <section id="home-section" hidden>
                                <div class="home-center">
                                        <img src="Assets/Icons/PlasmaPuffs.png" alt="PlasmaPuffs Icon" class="undraggable home-logo">
                                        <h1 class="home-title">PlasmaPuffs</h1>
                                        <div class="socials">
                                                <a href="https://github.com/DeveloperPuffs" target="_blank" aria-label="GitHub">
                                                        <img src="Assets/Icons/GitHubWhite.svg" alt="GitHub" class="undraggable">
                                                </a>
                                                <a href="https://discord.com/users/756913583706865746" target="_blank" aria-label="Discord">
                                                        <img src="Assets/Icons/DiscordWhite.svg" alt="Discord" class="undraggable">
                                                </a>
                                                <a href="https://plasmapuffs.itch.io" target="_blank" aria-label="Itch.io">
                                                        <img src="Assets/Icons/ItchWhite.svg" alt="Itch.io" class="undraggable">
                                                </a>
                                        </div>
                                </div>
                        </section>
                        <section class="page-wrapper" id="page-section" hidden>
                        </section>
                        <section class="page-wrapper" id="void-section" hidden>
                                <h1>Page not Found</h1>
                                <p>The page couldn't be loaded.</p>
                                <details>
                                        <summary>Show Details</summary>
                                        <p class="secondary-text"><small>Requested path: <code id="void-path"></code></small></p>
                                        <pre id="void-details"><pre>
                                </details>
                                <br>
                                <br>
                                <div class="void-actions">
                                        <button onclick="loadPage()">Retry</button>
                                        <a href="/" class="button" data-navigation-link="">Return Home</a>
                                </div>
                        </section>
                </main>
        </body>
        <script>
                const homeSection = document.getElementById("home-section");
                const pageSection = document.getElementById("page-section");
                const voidSection = document.getElementById("void-section");

                const displayError = (() => {
                        const pathElement = document.getElementById("void-path");
                        const detailsElement = document.getElementById("void-details");

                        return (path, details = null) => {
                                pathElement.textContent = path;
                                detailsElement.textContent = details ?? "Unknown error.";
                        };
                })();

                function displaySection(section) {
                        console.info(`Displaying section: ${section}...`);
                        homeSection.hidden = true;
                        pageSection.hidden = true;
                        voidSection.hidden = true;
                        section.hidden = false;
                }

                async function loadPage(path = window.location.pathname) {
                        console.info(`Loading page from path: "${path}"...`);

                        // The path is "/Index.html" when running locally (during development) but
                        // I also need to include "/" since static servers treat "/Index.html" as
                        // the default page (or "/") in a directory.
                        if (path === "/" || path.endsWith("/Index.html")) {
                                displaySection(homeSection);
                                return;
                        }

                        let pageFile;
                        switch (path) {
                                case "/sokobee": {
                                        pageFile = "Sokobee.html";
                                        break
                                }

                                default: {
                                        displaySection(voidSection);
                                        displayError(path, "Path is not recognized.");
                                        return;
                                }
                        }

                        try {
                                const response = await fetch(pageFile);
                                if (response.ok === false) {
                                        displaySection(voidSection);
                                        displayError(path, `${response.status} ${response.statusText}`);
                                        return;
                                }

                                displaySection(pageSection);
                                pageSection.innerHTML = await response.text();

                                // Scripts added directly to the HTML as strings don't get executed so I
                                // need to replace them my themselves manually to execute each script.
                                const scripts = pageSection.querySelectorAll("script");
                                for (const script of scripts) {
                                        const newScript = document.createElement("script");

                                        if (script.textContent) {
                                                newScript.textContent = script.textContent;
                                        }

                                        for (const attribute of script.attributes) {
                                                newScript.setAttribute(attribute.name, attribute.value);
                                        }

                                        script.parentNode.replaceChild(newScript, script);
                                }
                        } catch (error) {
                                displaySection(voidSection);
                                displayError(path, `Navigation error: ${error}`);
                                return;
                        }
                };

                // When a navigation link is clicked, the behavior is overriden to correctly use
                // the browser's history API to change the page.
                document.addEventListener("click", event => {
                        const link = event.target.closest("[data-navigation-link]");
                        if (link === null) {
                                return;
                        }

                        event.preventDefault();

                        const path = link.getAttribute("href");
                        history.pushState({}, "", path);
                        loadPage(path);
                });

                // Update the state of the page for when the forward or back buttons are pressed.
                window.addEventListener("popstate", () => {
                        loadPage(window.location.pathname);
                });

                // The 404 fallback script adds a query parameter before redirecting to this page
                // to keep track of the current page (when reloading on github pages). If the
                // paramter contains a value, this will set the state correctly with the history
                // API.
                const searchParameters = new URLSearchParams(window.location.search);
                if (searchParameters.has("redirect")) {
                        const redirectPath = searchParameters.get("redirect");
                        history.replaceState({}, "", redirectPath);
                }

                loadPage();
        </script>
</html>